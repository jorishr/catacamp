require("dotenv").config({debug:process.env.DEBUG});const{campgroundService:campgroundService}=require("../../services/index"),express=require("express"),router=express.Router(),isLoggedIn=require("../../middleware/isLoggedIn"),NodeGeocoder=require("node-geocoder"),geoOptions=require("../../helpers/geoDataOptions");router.get("/new",isLoggedIn,(e,r)=>{r.render("campgrounds/new-campground")}),router.post("/",isLoggedIn,async(e,r,o)=>{try{const{newName:o,newPrice:n,newDescription:s}=e.body,a="images/catacamp_placeholder1920x1200.gif",d=e.body.newImage||a,c={id:e.user._id,username:e.user.username},t=NodeGeocoder(geoOptions),i=await t.geocode(e.body.newLocation);if(!i.length)return e.flash("error","Invalid campground location address"),r.redirect("/campgrounds/new");const u=i[0].latitude,g=i[0].longitude,p={name:o,image:d,price:n,description:s,author:c,location:i[0].formattedAddress,lat:u,lng:g};return await campgroundService.create(p),e.flash("success","New campground succesfully added!"),r.redirect("campgrounds")}catch(o){return o.status=500,o.message=o,e.flash("error","An error occurred. Try again or contact the administrator"),r.redirect("/campgrounds/new")}}),module.exports=router;