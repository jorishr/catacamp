require("dotenv").config({debug:process.env.DEBUG});const express=require("express"),router=express.Router(),passport=require("passport"),User=require("../models/user");router.get("/",(e,r)=>{r.render("landing")}),router.get("/register",(e,r)=>{r.render("users/register")}),router.post("/register",async(e,r,s)=>{try{await User.register(new User({username:e.body.username,firstname:e.body.firstName,lastname:e.body.lastName,email:e.body.email,dateOfBirth:e.body.dateOfBirth}),e.body.password),e.flash("success",`Welcome to Yelp Camp, ${e.body.username}! You are now registered successfully!`),passport.authenticate("local")(e,r,function(){r.redirect("/campgrounds")})}catch(e){return r.render("users/register",{error:e.message})}}),router.get("/login",(e,r)=>{r.render("users/login")}),router.post("/login",passport.authenticate("local",{successRedirect:"/campgrounds",failureRedirect:"/login",failureFlash:"Invalid username or password."}),(e,r,s)=>{if(err)return err.shouldRedirect=!0,s(err)}),router.get("/logout",(e,r,s)=>{e.logout(),e.flash("success","Logged out successfully!"),r.redirect("/campgrounds")}),module.exports=router;